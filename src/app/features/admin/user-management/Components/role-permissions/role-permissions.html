<p-confirmDialog></p-confirmDialog>

<div class="p-6 bg-slate-50 min-h-screen" [dir]="dir.currentDir()">
  <div class="max-w-5xl mx-auto">
    <div
      class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 mb-8 flex flex-col md:flex-row justify-between items-center gap-4"
    >
      <div class="flex items-center gap-4">
        <div class="p-4 bg-indigo-50 rounded-2xl">
          <i class="pi pi-shield text-indigo-600 text-3xl"></i>
        </div>
        <div>
          <h1 class="text-2xl font-black text-slate-800 m-0">
            صلاحيات الدور: <span class="text-indigo-600">{{ roleName() }}</span>
          </h1>
          <p class="text-slate-500 mt-1 font-medium">إدارة وتخصيص الوصول لهذا الدور الوظيفي</p>
        </div>
      </div>

      <div class="flex gap-2">
        <p-button
          label="رجوع للأدوار"
          icon="pi pi-arrow-right"
          [routerLink]="['../']"
          styleClass="p-button-outlined p-button-secondary rounded-xl"
        ></p-button>
        <p-button
          label="إسناد صلاحية"
          icon="pi pi-plus"
          (onClick)="openAddDialog()"
          styleClass="p-button-indigo rounded-xl shadow-md"
        ></p-button>
      </div>
    </div>

    <div class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
      <p-table
        [value]="facade.rolePermissions()"
        [loading]="facade.isLoading()"
        styleClass="p-datatable-striped p-datatable-lg"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="text-right p-5 bg-slate-50 text-slate-600 font-bold">معرف الصلاحية</th>
            <th class="text-right p-5 bg-slate-50 text-slate-600 font-bold">اسم الصلاحية</th>
            <th class="text-center p-5 bg-slate-50 text-slate-600 font-bold">إجراء</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-perm>
          <tr class="hover:bg-indigo-50/30 transition-all">
            <td class="p-5 font-mono text-slate-400">#{{ perm.id || perm.permissionId }}</td>
            <td class="p-5 font-bold text-slate-700">
              <span class="inline-block w-2 h-2 rounded-full bg-indigo-500 ml-2"></span>
              {{ perm.name || perm.permissionName }}
            </td>
            <td class="p-5 text-center">
              <button
                pButton
                icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-text"
                (click)="removePermissionFromRole(perm.name || perm.permissionName)"
                pTooltip="حذف من الدور"
              ></button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="3" class="text-center p-16">
              <div class="flex flex-col items-center text-slate-400">
                <i class="pi pi-lock-open text-5xl mb-3"></i>
                <p class="text-lg">هذا الدور لا يملك أي صلاحيات حالياً</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<p-dialog
  [(visible)]="displayAddDialog"
  header="إضافة صلاحية للدور"
  [modal]="true"
  [style]="{ width: '420px' }"
  styleClass="rounded-3xl shadow-2xl overflow-hidden"
  [draggable]="false"
  [dir]="dir.currentDir()"
>
  <div class="flex flex-col gap-6 pt-6">
    <div class="flex flex-col gap-3">
      <label class="font-bold text-slate-700 flex items-center gap-2">
        <i class="pi pi-list text-indigo-500"></i>
        اختر الصلاحية المراد إضافتها
      </label>
      <p-select
        [options]="facade.permissions()"
        [(ngModel)]="selectedPermissionName"
        optionLabel="name"
        optionValue="name"
        placeholder="ابحث عن صلاحية..."
        styleClass="w-full rounded-2xl border-slate-200"
        [filter]="true"
        appendTo="body"
      ></p-select>
      <small class="text-slate-400">سيتم تطبيق هذه الصلاحية على جميع مستخدمي هذا الدور.</small>
    </div>

    <div class="flex justify-end gap-3 mt-4">
      <p-button
        label="إلغاء"
        [text]="true"
        severity="secondary"
        (onClick)="displayAddDialog.set(false)"
      ></p-button>
      <p-button
        label="تأكيد الربط"
        icon="pi pi-check"
        (onClick)="assignPermissionToRole()"
        [disabled]="!selectedPermissionName()"
        styleClass="rounded-2xl px-8 py-3 font-bold"
      ></p-button>
    </div>
  </div>
</p-dialog>
