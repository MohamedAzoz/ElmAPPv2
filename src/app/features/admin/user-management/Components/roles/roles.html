<p-confirmDialog></p-confirmDialog>

<div class="p-6 bg-slate-50 min-h-screen" [dir]="dir.currentDir()">
  <div class="max-w-6xl mx-auto">
    
    <div class="flex flex-col md:flex-row justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-6 gap-4">
      <div>
        <h1 class="text-3xl font-black text-slate-800 m-0">إدارة الأدوار (Roles)</h1>
        <p class="text-slate-500 mt-1">تحديد المجموعات الوظيفية وتخصيص صلاحيات الوصول لها</p>
      </div>
      <p-button 
        label="إنشاء دور جديد" 
        icon="pi pi-plus" 
        (onClick)="openAddDialog()"
        styleClass="p-button-primary rounded-xl px-5 py-3 font-bold shadow-md"
      ></p-button>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
      <p-table 
        [value]="roleFacade.roles()" 
        [loading]="roleFacade.isLoading()"
        [showGridlines]="true" 
        [stripedRows]="true"
        [resizableColumns]="true"
        [reorderableColumns]="true"
        [rowHover]="true"
        styleClass="p-datatable-gridlines p-datatable-striped"
        
      >
        <ng-template pTemplate="header">
          <tr class="bg-slate-50">
            <th class="p-4 text-right text-slate-600">اسم الدور الوظيفي</th>
            <th class="p-4 text-center text-slate-600">الصلاحيات</th>
            <th class="p-4 text-center text-slate-600">الإجراءات</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-role>
          <tr class="hover:bg-blue-50/20 transition-colors">
            <td class="p-4">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-lg flex items-center justify-center font-bold">
                  {{ role.name?.charAt(0) }}
                </div>
                <span class="font-bold text-slate-700 text-lg">{{ role.name }}</span>
              </div>
            </td>
            <td class="p-4 text-center">
              <button 
                pButton 
                label="عرض صلاحيات الدور" 
                icon="pi pi-verified" 
                class="p-button-outlined p-button-info p-button-sm rounded-lg"
                [routerLink]="['role-permissions']"
                [queryParams]="{roleName: role.name}"
              ></button>
            </td>
            <td class="p-4 text-center">
              <div class="flex justify-center gap-2">
                <button 
                  pButton 
                  icon="pi pi-pencil" 
                  class="p-button-rounded p-button-warning p-button-text"
                  (click)="openEditDialog(role)"
                  pTooltip="تعديل المسمى"
                ></button>
                <button 
                  pButton 
                  icon="pi pi-trash" 
                  class="p-button-rounded p-button-danger p-button-text"
                  (click)="confirmDelete(role.name)"
                  pTooltip="حذف الدور"
                ></button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="3" class="text-center p-12 text-slate-400">
              <i class="pi pi-shield text-5xl mb-4 block"></i>
              لا توجد أدوار محددة في النظام حتى الآن.
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<p-dialog 
  [(visible)]="displayDialog" 
  [header]="isEditMode() ? 'تعديل مسمى الدور' : 'إنشاء دور جديد'" 
  [modal]="true" 
  [style]="{ width: '400px' }"
  styleClass="rounded-2xl shadow-2xl"
  [draggable]="false"
  [dir]="dir.currentDir()"
>
  <div class="flex flex-col gap-5 pt-4">
    <div class="flex flex-col gap-2">
      <label class="font-bold text-slate-700">اسم الدور (Role Name)</label>
      <input 
        pInputText 
        [(ngModel)]="roleForm.newName" 
        placeholder="مثلاً: Admin, Editor, Doctor..." 
        class="w-full p-3 rounded-xl border-slate-200 focus:border-indigo-500"
      />
      @if (isEditMode()) {
        <small class="text-amber-600 italic">أنت الآن تقوم بتغيير الاسم من: <b>{{ roleForm.oldName }}</b></small>
      }
    </div>

    <div class="flex justify-end gap-3 mt-4">
      <p-button label="إلغاء" [text]="true" severity="secondary" (onClick)="displayDialog.set(false)"></p-button>
      <p-button 
        [label]="isEditMode() ? 'تحديث الاسم' : 'إنشاء الدور'" 
        [icon]="isEditMode() ? 'pi pi-refresh' : 'pi pi-check'" 
        (onClick)="saveRole()" 
        [disabled]="!roleForm.newName"
        styleClass="rounded-xl px-6"
      ></p-button>
    </div>
  </div>
</p-dialog>