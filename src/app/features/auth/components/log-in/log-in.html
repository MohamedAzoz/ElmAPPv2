@if (rateLimitService.isLoginLocked()) {
  <app-lock-ui type="login"></app-lock-ui>
} @else {
  <div class="min-h-screen flex items-stretch bg-surface" dir="ltr">
    <div
      class="hidden lg:flex lg:w-1/2 bg-linear-to-br from-indigo-700 via-blue-800 to-indigo-900 items-center justify-center p-12 relative overflow-hidden"
    >
      <div class="relative text-center z-10" dir="ltr">
        <div class="bg-white/10 backdrop-blur-lg p-8 rounded-3xl border border-white/20 shadow-2xl">
          <i class="pi pi-graduation-cap text-white mb-6 block drop-shadow-lg"></i>
          <h1 class="text-3xl lg:text-4xl font-black text-white mb-4 tracking-tight">
            منصة الجامعة الذكية
          </h1>
          <p class="text-blue-100 text-lg lg:text-xl leading-relaxed max-w-md mx-auto">
            مرحباً بك في بوابتك الأكاديمية الرقمية. تواصل مع كليتك بكل سهولة.
          </p>
        </div>
      </div>
      <div
        class="absolute top-[-10%] right-[-10%] w-96 h-96 bg-white/10 rounded-full blur-3xl"
      ></div>
      <div
        class="absolute bottom-[-10%] left-[-10%] w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"
      ></div>
    </div>

    <div class="w-full lg:w-1/2 flex items-center justify-center p-8 md:p-16 bg-gray-50">
      <div class="w-full max-w-md space-y-8">
        <div class="text-center lg:text-start">
          <h2 class="text-3xl font-bold text-gray-900 tracking-tight">تسجيل الدخول</h2>
          <p class="mt-2 text-gray-500 font-medium">قم بإدخال بياناتك الأكاديمية للمتابعة</p>
        </div>
        @if (authFacade.error()) {
          <p-message
            severity="error"
            [text]="authFacade.error()!"
            styleClass="w-full mb-4"
          ></p-message>
        }
        <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="mt-8 space-y-6">
          <div class="space-y-4">
            <div class="flex flex-col gap-0.5">
              <label class="text-sm font-semibold text-gray-700">اسم المستخدم</label>
              <div class="w-full flex justify-center items-center">
                <i
                  class="pi pi-user p-3 text-gray-400 bg-white/30 border-2 border-gray-200 rounded-l-lg"
                ></i>
                <input
                  type="text"
                  pInputText
                  formControlName="userName"
                  placeholder="أدخل اسم المستخدم"
                  class="w-full border-gray-200 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 rounded-r-lg transition-all shadow-sm"
                  [invalid]="
                    loginForm.get('userName')?.touched &&
                    (loginForm.get('userName')?.hasError('required') ||
                      loginForm.get('userName')?.hasError('pattern'))
                  "
                  pattern="^[a-zA-Z][a-zA-Z0-9@#$!%*?&]{6,25}$"
                />
              </div>
              @if (
                loginForm.get('userName')?.touched &&
                loginForm.get('userName')?.hasError('required')
              ) {
                <small class="text-red-500 font-medium ml-1 animate-fadein"
                  >اسم المستخدم مطلوب</small
                >
              }
              @if (loginForm.get('userName')?.hasError('pattern')) {
                <small class="text-red-500 font-medium ml-1 animate-fadein"
                  >اسم المستخدم يجب ان يحتوى على حرف كبير وصغير ورقم ورمز واحد على الاقل</small
                >
              }
            </div>

            <div class="flex flex-col gap-0.5">
              <label class="text-sm font-semibold text-gray-700">كلمة المرور</label>
              <div class="w-full flex justify-center items-center">
                <i
                  class="pi pi-lock p-3 text-gray-400 bg-white/30 border-2 border-gray-200 rounded-l-lg"
                ></i>
                <p-password
                  formControlName="password"
                  [toggleMask]="true"
                  [feedback]="false"
                  placeholder="••••••••"
                  styleClass="w-full"
                  inputStyleClass="w-full p-3 rounded-xl border-gray-200 focus:border-indigo-500 shadow-sm"
                  [invalid]="
                    loginForm.get('password')?.touched &&
                    (loginForm.get('password')?.value.length < 6 ||
                      loginForm.get('password')?.hasError('required'))
                  "
                  pattern="^[a-zA-Z][a-zA-Z0-9@#$!%*?&]{6,25}$"
                ></p-password>
              </div>
              @if (
                loginForm.get('password')?.touched &&
                loginForm.get('password')?.hasError('required')
              ) {
                <small class="text-red-500 font-medium ml-1 animate-fadein"
                  >كلمة المرور مطلوبة (6 أحرف على الأقل)</small
                >
              }
              @if (loginForm.get('password')?.hasError('pattern')) {
                <small class="text-red-500 font-medium ml-1 animate-fadein"
                  >كلمة المرور يجب ان تحتوى على حرف كبير وصغير ورقم ورمز واحد على الاقل</small
                >
              }
            </div>
          </div>

          <div>
            <button
              pButton
              type="submit"
              label="تسجيل الدخول"
              [loading]="authFacade.isLoading()"
              [disabled]="loginForm.invalid"
              class="w-full p-4 bg-main hover:bg-main-hover border-none rounded-xl text-lg font-bold shadow-lg shadow-accent-soft transition-all transform hover:-translate-y-0.5 active:scale-95"
            ></button>
          </div>
        </form>
      </div>
    </div>
  </div>
}
