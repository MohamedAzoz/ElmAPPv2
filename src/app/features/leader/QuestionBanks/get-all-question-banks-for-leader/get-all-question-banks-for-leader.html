<p-confirmDialog></p-confirmDialog>

<div class="p-6 bg-slate-50 min-h-screen" [dir]="dir.currentDir()">
  <div class="max-w-6xl mx-auto">
    
    <div class="flex flex-wrap gap-2 md:justify-between justify-center items-center mb-6 bg-surface p-4 rounded-xl shadow-lg">
      <div>
        <h1 class="text-2xl font-bold text-text-dark m-0">إدارة بنوك الأسئلة</h1>
        <p class="text-text-muted">قم بإضافة وتعديل بنوك الأسئلة لهذا المنهج</p>
      </div>
      <!-- back button -->
      <div class="flex gap-2">
        <p-button 
          label="رجوع" 
          icon="pi pi-arrow-right" 
          severity="secondary" 
         [routerLink]="['../']"
        styleClass="rounded-xl shadow-md"
      ></p-button>
      </div>
      <div class="flex gap-2">
        <p-button 
          label="بنك جديد" 
          icon="pi pi-plus" 
          severity="primary" 
          (onClick)="showAddDialog()"
        styleClass="rounded-xl shadow-md"
      ></p-button>
      </div>
    </div>

    <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
      <p-table 
        [value]="facade.questionBanks()" 
        [loading]="facade.isLoading()"
        [rows]="10" 
        [paginator]="true"
        styleClass="p-datatable-striped"
        responsiveLayout="stack"
      >
        <ng-template pTemplate="header">
          <tr class="bg-slate-50">
            <th class="text-right py-4 px-6">اسم البنك</th>
            <th class="text-center">تاريخ الإنشاء</th>
            <th class="text-center">الإجراءات</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-bank>
          <tr class="hover:bg-slate-50/50 transition-colors">
            <td class="py-4 px-6 font-semibold text-slate-700">
              <i class="pi pi-database text-indigo-500 mr-2"></i>
              {{ bank.name }}
            </td>
            <td class="text-center text-slate-500">
              {{ bank.createdAt | date:'dd/MM/yyyy' }}
            </td>
            <td class="text-center">
              <div class="flex justify-center gap-2">
                <button 
                  pButton icon="pi pi-file-plus" 
                  class="p-button-rounded p-button-text p-button-success" 
                  pTooltip="إضافة أسئلة داخل البنك"
                  (click)="addQuestions(bank.id)"
                ></button>
                
                <button 
                  pButton icon="pi pi-pencil" 
                  class="p-button-rounded p-button-text p-button-info" 
                  (click)="showEditDialog(bank)"
                ></button>

                <button 
                  pButton icon="pi pi-trash" 
                  class="p-button-rounded p-button-text p-button-danger" 
                  (click)="confirmDelete(bank.id)"
                ></button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="3" class="text-center py-12">
              <i class="pi pi-folder-open text-4xl text-slate-300 mb-3"></i>
              <p class="text-slate-500">لا توجد بنوك أسئلة مضافة حالياً</p>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<p-dialog 
  [(visible)]="displayDialog" 
  [header]="isEditMode() ? 'تعديل اسم البنك' : 'إضافة بنك جديد'" 
  [modal]="true" 
  [style]="{width: '450px'}" 
  styleClass="rounded-2xl"
>
  <div class="flex flex-col gap-4 mt-2">
    <div class="flex flex-col gap-2">
      <label for="name" class="font-bold text-slate-700">اسم البنك</label>
      <input 
        id="name" 
        pInputText 
        [(ngModel)]="bankForm.name" 
        placeholder="مثلاً: الفصل الأول - أساسيات" 
        class="w-full rounded-xl"
      />
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button 
      label="إلغاء" 
      icon="pi pi-times" 
      [text]="true" 
      severity="secondary" 
      (onClick)="displayDialog.set(false)"
    ></p-button>
    <p-button 
      [label]="isEditMode() ? 'تحديث' : 'حفظ'" 
      icon="pi pi-check" 
      (onClick)="saveBank()"
      [disabled]="!bankForm.name"
    ></p-button>
  </ng-template>
</p-dialog>