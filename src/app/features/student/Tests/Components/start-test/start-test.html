<div class="min-h-[80vh] flex items-center justify-center bg-bg-page p-4 py-6">
  <p-card class="w-full max-w-xl shadow-2xl border-0 rounded-3xl overflow-hidden animate-fadein">
    @if (rateLimitService.isTestLocked()) {
      <app-lock-ui type="test"></app-lock-ui>
    } @else {
      <div class="text-center mb-8">
        <div
          class="inline-flex items-center justify-center w-20 h-20 bg-accent-soft rounded-full mb-4"
        >
          <i class="pi pi-bolt text-main" style="font-size: 1.5rem;font-weight: bold;"></i>
        </div>
        <h1 class="text-3xl font-black text-text-main">تجهيز الاختبار</h1>
        <p class="text-text-muted mt-2">اختر البنك وحدد عدد الأسئلة لتبدأ التحدي</p>
      </div>

      <div class="flex flex-col gap-8 px-4">
        <div class="flex flex-col gap-2">
          <label class="font-bold text-text-main mr-2">بنك الأسئلة المتاح</label>
          <p-select
            [options]="bankFacade.questionBanks()"
            [(ngModel)]="selectedBank"
            optionLabel="name"
            placeholder="اختر بنك الأسئلة"
            class="w-full"
            styleClass="w-full rounded-xl border-text-muted shadow-sm"
            [loading]="bankFacade.isQuestionBanktLoading()"
          >
            <ng-template let-bank pTemplate="item">
              <div class="flex justify-between items-center w-full">
                <span>{{ bank.name }}</span>
              </div>
            </ng-template>
          </p-select>
        </div>

        <div class="flex flex-col gap-2">
          <label class="font-bold text-text-main mr-2">عدد الأسئلة المطلوبة</label>
          <div class="p-inputgroup w-full">
            <span class="p-inputgroup-addon bg-surface border-e-0 rounded-s-xl">
              <i class="pi pi-list"></i>
            </span>
            <p-inputNumber
              [(ngModel)]="numQuestions"
              [min]="1"
              [max]="bankFacade.countQuestionsInBank() || 10"
              [showButtons]="true"
              buttonLayout="horizontal"
              spinnerMode="horizontal"
              inputStyleClass="text-center border-x-0"
              class="w-full"
              styleClass="w-full"
              incrementButtonClass="p-button-secondary rounded-e-xl"
              decrementButtonClass="p-button-secondary"
              incrementButtonIcon="pi pi-plus"
              decrementButtonIcon="pi pi-minus"
            />
          </div>
          @if (selectedBank()) {
            <small class="text-main font-medium mr-2">
              * الحد الأقصى المتاح في هذا البنك: {{ bankFacade.countQuestionsInBank() }} سؤال
            </small>
          }
        </div>

        <div class="mt-4">
          <p-button
            [disabled]="!selectedBank()"
            label="ابدأ الاختبار الآن"
            icon="pi pi-play"
            severity="primary"
            class="w-full"
            styleClass="w-full py-4 text-xl font-semibold rounded-2xl shadow-lg transition-transform hover:scale-[1.02]"
            (onClick)="onStart()"
            [loading]="testFacade.isStarting()"
          />
        </div>
      </div>

      <ng-template #footer>
        <div class="text-center text-text-muted text-sm pb-4">
          <i class="pi pi-info-circle mr-1"></i>
          سيتم إنشاء جلسة اختبار خاصة بك فور الضغط على ابدأ
        </div>
      </ng-template>
    }
  </p-card>
</div>
